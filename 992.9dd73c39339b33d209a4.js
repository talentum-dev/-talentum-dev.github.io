"use strict";(self.webpackChunktraining_app=self.webpackChunktraining_app||[]).push([[992],{3992:(nt,se,g)=>{g.r(se),g.d(se,{amplify_chatbot:()=>Ee});var e,L=g(8239),_=g(4600),O=g(1735),re=g(3531),Q=g(6845),P=g(6289),Te=g(4102),Ae=g(6817),F=function(){return(F=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},Ce=new O.k("AbstractInteractionsProvider"),Ie=function(){function e(t){void 0===t&&(t={}),this._config=t}return e.prototype.configure=function(t){return void 0===t&&(t={}),this._config=F(F({},this._config),t),Ce.debug("configure "+this.getProviderName(),this._config),this.options},e.prototype.getCategory=function(){return"Interactions"},Object.defineProperty(e.prototype,"options",{get:function(){return F({},this._config)},enumerable:!0,configurable:!0}),e}(),a=g(4762),Ne=g(7235),ae=g(201),Re=g(5672),Y=g(9221),oe=g(918),ze=g(358),Pe=g(9511),le=g(4952),de="runtime.lex.{region}.amazonaws.com",je=new Set(["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-south-1","ap-southeast-1","ap-southeast-2","ca-central-1","eu-central-1","eu-north-1","eu-south-1","eu-west-1","eu-west-2","eu-west-3","me-south-1","sa-east-1","us-east-1","us-east-2","us-west-1","us-west-2"]),ke=new Set(["cn-north-1","cn-northwest-1"]),Je=new Set(["us-iso-east-1"]),Oe=new Set(["us-isob-east-1"]),Ge=new Set(["us-gov-east-1","us-gov-west-1"]),ce={apiVersion:"2016-11-28",disableHostPrefix:!1,logger:{},regionInfoProvider:function(e,t){var n=void 0;switch(e){case"ap-northeast-1":n={hostname:"runtime.lex.ap-northeast-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"ap-southeast-1":n={hostname:"runtime.lex.ap-southeast-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"ap-southeast-2":n={hostname:"runtime.lex.ap-southeast-2.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-central-1":n={hostname:"runtime.lex.eu-central-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-west-1":n={hostname:"runtime.lex.eu-west-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"eu-west-2":n={hostname:"runtime.lex.eu-west-2.amazonaws.com",partition:"aws",signingService:"lex"};break;case"us-east-1":n={hostname:"runtime.lex.us-east-1.amazonaws.com",partition:"aws",signingService:"lex"};break;case"us-west-2":n={hostname:"runtime.lex.us-west-2.amazonaws.com",partition:"aws",signingService:"lex"};break;default:je.has(e)&&(n={hostname:de.replace("{region}",e),partition:"aws",signingService:"lex"}),ke.has(e)&&(n={hostname:"runtime.lex.{region}.amazonaws.com.cn".replace("{region}",e),partition:"aws-cn"}),Je.has(e)&&(n={hostname:"runtime.lex.{region}.c2s.ic.gov".replace("{region}",e),partition:"aws-iso"}),Oe.has(e)&&(n={hostname:"runtime.lex.{region}.sc2s.sgov.gov".replace("{region}",e),partition:"aws-iso-b"}),Ge.has(e)&&(n={hostname:"runtime.lex.{region}.amazonaws.com".replace("{region}",e),partition:"aws-us-gov"}),void 0===n&&(n={hostname:de.replace("{region}",e),partition:"aws",signingService:"lex"})}return Promise.resolve((0,a.pi)({signingService:"lex"},n))},serviceId:"Lex Runtime Service",urlParser:g(5241).e},Ve=(0,a.pi)((0,a.pi)({},ce),{runtime:"browser",base64Decoder:oe.G,base64Encoder:oe.s,bodyLengthChecker:ze.W,credentialDefaultProvider:function(e){return function(){return Promise.reject(new Error("Credential is missing"))}},defaultUserAgentProvider:(0,Pe.f)({serviceId:ce.serviceId,clientVersion:"3.6.1"}),maxAttempts:Y.J,region:(0,Re.n)("Region is missing"),requestHandler:new ae.B,sha256:Ne.Sha256,streamCollector:ae.C,utf8Decoder:le.fromUtf8,utf8Encoder:le.toUtf8}),ue=g(609),He=g(8e3),fe=g(7969),qe=g(1399),me=g(5845),ve=g(9153),h=g(7586),We=function(e){function t(n){var i=this,s=(0,a.pi)((0,a.pi)({},Ve),n),r=(0,ue.Xb)(s),l=(0,ue.g4)(r),d=(0,me.A$)(l),u=(0,Y.BC)(d),o=(0,fe.S8)(u),c=(0,ve.er)(o);return(i=e.call(this,c)||this).config=c,i.middlewareStack.use((0,me.yt)(i.config)),i.middlewareStack.use((0,Y.NQ)(i.config)),i.middlewareStack.use((0,He.VG)(i.config)),i.middlewareStack.use((0,fe.G2)(i.config)),i.middlewareStack.use((0,qe.cV)(i.config)),i.middlewareStack.use((0,ve.XJ)(i.config)),i}return(0,a.ZT)(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t}(h.KU),G=(()=>((G||(G={})).filterSensitiveLog=function(t){return(0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)({},t),t.sessionAttributes&&{sessionAttributes:h.oc}),t.requestAttributes&&{requestAttributes:h.oc}),t.activeContexts&&{activeContexts:h.oc})},G))(),$=(()=>(($||($={})).filterSensitiveLog=function(t){return(0,a.pi)((0,a.pi)((0,a.pi)({},t),t.message&&{message:h.oc}),t.activeContexts&&{activeContexts:h.oc})},$))(),U=(()=>((U||(U={})).filterSensitiveLog=function(t){return(0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)({},t),t.sessionAttributes&&{sessionAttributes:h.oc}),t.requestAttributes&&{requestAttributes:h.oc}),t.inputText&&{inputText:h.oc}),t.activeContexts&&{activeContexts:h.oc})},U))(),V=(()=>((V||(V={})).filterSensitiveLog=function(t){return(0,a.pi)((0,a.pi)({},t),t.slots&&{slots:h.oc})},V))(),H=(()=>((H||(H={})).filterSensitiveLog=function(t){return(0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)({},t),t.alternativeIntents&&{alternativeIntents:t.alternativeIntents.map(function(n){return V.filterSensitiveLog(n)})}),t.slots&&{slots:h.oc}),t.sessionAttributes&&{sessionAttributes:h.oc}),t.message&&{message:h.oc}),t.activeContexts&&{activeContexts:h.oc})},H))(),ge=g(1564),en=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i,s,r,d,u,o,c,m,b,S,v,y,A,C,p,te,ie;return(0,a.Jh)(this,function(w){switch(w.label){case 0:return i=[(0,a.pi)({},e)],ie={},[4,I(e.body,t)];case 1:switch(n=a.pi.apply(void 0,i.concat([(ie.body=w.sent(),ie)])),r="UnknownError",r=J(e,n.body)){case"BadGatewayException":case"com.amazonaws.lexruntimeservice#BadGatewayException":return[3,2];case"BadRequestException":case"com.amazonaws.lexruntimeservice#BadRequestException":return[3,4];case"ConflictException":case"com.amazonaws.lexruntimeservice#ConflictException":return[3,6];case"DependencyFailedException":case"com.amazonaws.lexruntimeservice#DependencyFailedException":return[3,8];case"InternalFailureException":case"com.amazonaws.lexruntimeservice#InternalFailureException":return[3,10];case"LimitExceededException":case"com.amazonaws.lexruntimeservice#LimitExceededException":return[3,12];case"LoopDetectedException":case"com.amazonaws.lexruntimeservice#LoopDetectedException":return[3,14];case"NotAcceptableException":case"com.amazonaws.lexruntimeservice#NotAcceptableException":return[3,16];case"NotFoundException":case"com.amazonaws.lexruntimeservice#NotFoundException":return[3,18];case"RequestTimeoutException":case"com.amazonaws.lexruntimeservice#RequestTimeoutException":return[3,20];case"UnsupportedMediaTypeException":case"com.amazonaws.lexruntimeservice#UnsupportedMediaTypeException":return[3,22]}return[3,24];case 2:return d=[{}],[4,K(n,t)];case 3:return s=a.pi.apply(void 0,[a.pi.apply(void 0,d.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 4:return u=[{}],[4,B(n,t)];case 5:return s=a.pi.apply(void 0,[a.pi.apply(void 0,u.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 6:return o=[{}],[4,q(n,t)];case 7:return s=a.pi.apply(void 0,[a.pi.apply(void 0,o.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 8:return c=[{}],[4,ee(n,t)];case 9:return s=a.pi.apply(void 0,[a.pi.apply(void 0,c.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 10:return m=[{}],[4,D(n,t)];case 11:return s=a.pi.apply(void 0,[a.pi.apply(void 0,m.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 12:return b=[{}],[4,M(n,t)];case 13:return s=a.pi.apply(void 0,[a.pi.apply(void 0,b.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 14:return S=[{}],[4,he(n,t)];case 15:return s=a.pi.apply(void 0,[a.pi.apply(void 0,S.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 16:return v=[{}],[4,pe(n,t)];case 17:return s=a.pi.apply(void 0,[a.pi.apply(void 0,v.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 18:return y=[{}],[4,j(n,t)];case 19:return s=a.pi.apply(void 0,[a.pi.apply(void 0,y.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 20:return A=[{}],[4,rn(n,t)];case 21:return s=a.pi.apply(void 0,[a.pi.apply(void 0,A.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 22:return C=[{}],[4,an(n,t)];case 23:return s=a.pi.apply(void 0,[a.pi.apply(void 0,C.concat([w.sent()])),{name:r,$metadata:f(e)}]),[3,25];case 24:r=(p=n.body).code||p.Code||r,s=(0,a.pi)((0,a.pi)({},p),{name:""+r,message:p.message||p.Message||r,$fault:"client",$metadata:f(e)}),w.label=25;case 25:return s.message=te=s.message||s.Message||r,delete s.Message,[2,Promise.reject(Object.assign(new Error(te),s))]}})})},tn=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i,s,r,d,u,o,c,m,b,S,v,y,A,C;return(0,a.Jh)(this,function(p){switch(p.label){case 0:return i=[(0,a.pi)({},e)],C={},[4,I(e.body,t)];case 1:switch(n=a.pi.apply(void 0,i.concat([(C.body=p.sent(),C)])),r="UnknownError",r=J(e,n.body)){case"BadGatewayException":case"com.amazonaws.lexruntimeservice#BadGatewayException":return[3,2];case"BadRequestException":case"com.amazonaws.lexruntimeservice#BadRequestException":return[3,4];case"ConflictException":case"com.amazonaws.lexruntimeservice#ConflictException":return[3,6];case"DependencyFailedException":case"com.amazonaws.lexruntimeservice#DependencyFailedException":return[3,8];case"InternalFailureException":case"com.amazonaws.lexruntimeservice#InternalFailureException":return[3,10];case"LimitExceededException":case"com.amazonaws.lexruntimeservice#LimitExceededException":return[3,12];case"LoopDetectedException":case"com.amazonaws.lexruntimeservice#LoopDetectedException":return[3,14];case"NotFoundException":case"com.amazonaws.lexruntimeservice#NotFoundException":return[3,16]}return[3,18];case 2:return d=[{}],[4,K(n,t)];case 3:return s=a.pi.apply(void 0,[a.pi.apply(void 0,d.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 4:return u=[{}],[4,B(n,t)];case 5:return s=a.pi.apply(void 0,[a.pi.apply(void 0,u.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 6:return o=[{}],[4,q(n,t)];case 7:return s=a.pi.apply(void 0,[a.pi.apply(void 0,o.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 8:return c=[{}],[4,ee(n,t)];case 9:return s=a.pi.apply(void 0,[a.pi.apply(void 0,c.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 10:return m=[{}],[4,D(n,t)];case 11:return s=a.pi.apply(void 0,[a.pi.apply(void 0,m.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 12:return b=[{}],[4,M(n,t)];case 13:return s=a.pi.apply(void 0,[a.pi.apply(void 0,b.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 14:return S=[{}],[4,he(n,t)];case 15:return s=a.pi.apply(void 0,[a.pi.apply(void 0,S.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 16:return v=[{}],[4,j(n,t)];case 17:return s=a.pi.apply(void 0,[a.pi.apply(void 0,v.concat([p.sent()])),{name:r,$metadata:f(e)}]),[3,19];case 18:r=(y=n.body).code||y.Code||r,s=(0,a.pi)((0,a.pi)({},y),{name:""+r,message:y.message||y.Message||r,$fault:"client",$metadata:f(e)}),p.label=19;case 19:return s.message=A=s.message||s.Message||r,delete s.Message,[2,Promise.reject(Object.assign(new Error(A),s))]}})})},K=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"BadGatewayException",$fault:"server",$metadata:f(e),Message:void 0},null!=(i=e.body).Message&&(n.Message=i.Message),[2,n]})})},B=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"BadRequestException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},q=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"ConflictException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},ee=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"DependencyFailedException",$fault:"client",$metadata:f(e),Message:void 0},null!=(i=e.body).Message&&(n.Message=i.Message),[2,n]})})},D=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"InternalFailureException",$fault:"server",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},M=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"LimitExceededException",$fault:"client",$metadata:f(e),message:void 0,retryAfterSeconds:void 0},void 0!==e.headers["retry-after"]&&(n.retryAfterSeconds=e.headers["retry-after"]),null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},he=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"LoopDetectedException",$fault:"server",$metadata:f(e),Message:void 0},null!=(i=e.body).Message&&(n.Message=i.Message),[2,n]})})},pe=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"NotAcceptableException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},j=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"NotFoundException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},rn=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"RequestTimeoutException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},an=function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){return n={name:"UnsupportedMediaTypeException",$fault:"client",$metadata:f(e),message:void 0},null!=(i=e.body).message&&(n.message=i.message),[2,n]})})},ln=function(e,t){return Object.entries(e).reduce(function(n,i){var s,r=(0,a.CR)(i,2),l=r[0],d=r[1];return null===d?n:(0,a.pi)((0,a.pi)({},n),((s={})[l]=d,s))},{})},be=function(e,t){return e.filter(function(n){return null!=n}).map(function(n){return null===n?null:function(e,t){return(0,a.pi)((0,a.pi)((0,a.pi)({},null!=e.name&&{name:e.name}),null!=e.parameters&&{parameters:ln(e.parameters)}),null!=e.timeToLive&&{timeToLive:dn(e.timeToLive,t)})}(n,t)})},dn=function(e,t){return(0,a.pi)((0,a.pi)({},null!=e.timeToLiveInSeconds&&{timeToLiveInSeconds:e.timeToLiveInSeconds}),null!=e.turnsToLive&&{turnsToLive:e.turnsToLive})},k=function(e,t){return Object.entries(e).reduce(function(n,i){var s,r=(0,a.CR)(i,2),l=r[0],d=r[1];return null===d?n:(0,a.pi)((0,a.pi)({},n),((s={})[l]=d,s))},{})},vn=function(e,t){return Object.entries(e).reduce(function(n,i){var s,r=(0,a.CR)(i,2),l=r[0],d=r[1];return null===d?n:(0,a.pi)((0,a.pi)({},n),((s={})[l]=d,s))},{})},gn=function(e,t){return{timeToLiveInSeconds:null!=e.timeToLiveInSeconds?e.timeToLiveInSeconds:void 0,turnsToLive:null!=e.turnsToLive?e.turnsToLive:void 0}},xn=function(e,t){return(e||[]).filter(function(n){return null!=n}).map(function(n){return null===n?null:function(e,t){return{attachmentLinkUrl:null!=e.attachmentLinkUrl?e.attachmentLinkUrl:void 0,buttons:null!=e.buttons?wn(e.buttons,t):void 0,imageUrl:null!=e.imageUrl?e.imageUrl:void 0,subTitle:null!=e.subTitle?e.subTitle:void 0,title:null!=e.title?e.title:void 0}}(n,t)})},ye=function(e,t){return{score:null!=e.score?e.score:void 0}},wn=function(e,t){return(e||[]).filter(function(n){return null!=n}).map(function(n){return null===n?null:function(e,t){return{text:null!=e.text?e.text:void 0,value:null!=e.value?e.value:void 0}}(n)})},En=function(e,t){return{intentName:null!=e.intentName?e.intentName:void 0,nluIntentConfidence:null!=e.nluIntentConfidence?ye(e.nluIntentConfidence):void 0,slots:null!=e.slots?N(e.slots,t):void 0}},N=function(e,t){return Object.entries(e).reduce(function(n,i){var s,r=(0,a.CR)(i,2),l=r[0],d=r[1];return null===d?n:(0,a.pi)((0,a.pi)({},n),((s={})[l]=d,s))},{})},f=function(e){var t;return{httpStatusCode:e.statusCode,requestId:null!==(t=e.headers["x-amzn-requestid"])&&void 0!==t?t:e.headers["x-amzn-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}},R=function(e){return!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size)},I=function(e,t){return function(e,t){return function(e,t){return void 0===e&&(e=new Uint8Array),e instanceof Uint8Array?Promise.resolve(e):t.streamCollector(e)||Promise.resolve(new Uint8Array)}(e,t).then(function(n){return t.utf8Encoder(n)})}(e,t).then(function(n){return n.length?JSON.parse(n):{}})},J=function(e,t){var i=function(r){var l=r;return l.indexOf(":")>=0&&(l=l.split(":")[0]),l.indexOf("#")>=0&&(l=l.split("#")[1]),l},s=("x-amzn-errortype",Object.keys(e.headers).find(function(d){return d.toLowerCase()==="x-amzn-errortype".toLowerCase()}));return void 0!==s?i(e.headers[s]):void 0!==t.code?i(t.code):void 0!==t.__type?i(t.__type):""},_e=g(4924),Ln=function(e){function t(n){var i=e.call(this)||this;return i.input=n,i}return(0,a.ZT)(t,e),t.prototype.resolveMiddleware=function(n,i,s){this.middlewareStack.use((0,_e.p2)(i,this.serialize,this.deserialize));var r=n.concat(this.middlewareStack),c=i.requestHandler;return r.resolve(function(m){return c.handle(m.request,s||{})},{logger:i.logger,clientName:"LexRuntimeServiceClient",commandName:"PostTextCommand",inputFilterSensitiveLog:U.filterSensitiveLog,outputFilterSensitiveLog:H.filterSensitiveLog})},t.prototype.serialize=function(n,i){return function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i,s,r,l,u;return(0,a.Jh)(this,function(m){switch(m.label){case 0:if(n={"content-type":"application/json"},i="/bot/{botName}/alias/{botAlias}/user/{userId}/text",void 0===e.botName)throw new Error("No value provided for input HTTP label: botName.");if((s=e.botName).length<=0)throw new Error("Empty value provided for input HTTP label: botName.");if(i=i.replace("{botName}",(0,h.jc)(s)),void 0===e.botAlias)throw new Error("No value provided for input HTTP label: botAlias.");if((s=e.botAlias).length<=0)throw new Error("Empty value provided for input HTTP label: botAlias.");if(i=i.replace("{botAlias}",(0,h.jc)(s)),void 0===e.userId)throw new Error("No value provided for input HTTP label: userId.");if((s=e.userId).length<=0)throw new Error("Empty value provided for input HTTP label: userId.");return i=i.replace("{userId}",(0,h.jc)(s)),r=JSON.stringify((0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)({},null!=e.activeContexts&&{activeContexts:be(e.activeContexts,t)}),null!=e.inputText&&{inputText:e.inputText}),null!=e.requestAttributes&&{requestAttributes:k(e.requestAttributes)}),null!=e.sessionAttributes&&{sessionAttributes:k(e.sessionAttributes)})),[4,t.endpoint()];case 1:return l=m.sent(),[2,new ge.aW({protocol:void 0===(u=l.protocol)?"https":u,hostname:l.hostname,port:l.port,method:"POST",headers:n,path:i,body:r})]}})})}(n,i)},t.prototype.deserialize=function(n,i){return function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i;return(0,a.Jh)(this,function(s){switch(s.label){case 0:return 200!==e.statusCode&&e.statusCode>=300?[2,tn(e,t)]:(n={$metadata:f(e),activeContexts:void 0,alternativeIntents:void 0,botVersion:void 0,dialogState:void 0,intentName:void 0,message:void 0,messageFormat:void 0,nluIntentConfidence:void 0,responseCard:void 0,sentimentResponse:void 0,sessionAttributes:void 0,sessionId:void 0,slotToElicit:void 0,slots:void 0},[4,I(e.body,t)]);case 1:return null!=(i=s.sent()).activeContexts&&(n.activeContexts=function(e,t){return(e||[]).filter(function(n){return null!=n}).map(function(n){return null===n?null:function(e,t){return{name:null!=e.name?e.name:void 0,parameters:null!=e.parameters?vn(e.parameters):void 0,timeToLive:null!=e.timeToLive?gn(e.timeToLive,t):void 0}}(n,t)})}(i.activeContexts,t)),null!=i.alternativeIntents&&(n.alternativeIntents=function(e,t){return(e||[]).filter(function(n){return null!=n}).map(function(n){return null===n?null:En(n,t)})}(i.alternativeIntents,t)),null!=i.botVersion&&(n.botVersion=i.botVersion),null!=i.dialogState&&(n.dialogState=i.dialogState),null!=i.intentName&&(n.intentName=i.intentName),null!=i.message&&(n.message=i.message),null!=i.messageFormat&&(n.messageFormat=i.messageFormat),null!=i.nluIntentConfidence&&(n.nluIntentConfidence=ye(i.nluIntentConfidence)),null!=i.responseCard&&(n.responseCard=function(e,t){return{contentType:null!=e.contentType?e.contentType:void 0,genericAttachments:null!=e.genericAttachments?xn(e.genericAttachments,t):void 0,version:null!=e.version?e.version:void 0}}(i.responseCard,t)),null!=i.sentimentResponse&&(n.sentimentResponse=function(e,t){return{sentimentLabel:null!=e.sentimentLabel?e.sentimentLabel:void 0,sentimentScore:null!=e.sentimentScore?e.sentimentScore:void 0}}(i.sentimentResponse)),null!=i.sessionAttributes&&(n.sessionAttributes=N(i.sessionAttributes,t)),null!=i.sessionId&&(n.sessionId=i.sessionId),null!=i.slotToElicit&&(n.slotToElicit=i.slotToElicit),null!=i.slots&&(n.slots=N(i.slots,t)),[2,Promise.resolve(n)]}})})}(n,i)},t}(h.mY),Nn=function(e){function t(n){var i=e.call(this)||this;return i.input=n,i}return(0,a.ZT)(t,e),t.prototype.resolveMiddleware=function(n,i,s){this.middlewareStack.use((0,_e.p2)(i,this.serialize,this.deserialize));var r=n.concat(this.middlewareStack),c=i.requestHandler;return r.resolve(function(m){return c.handle(m.request,s||{})},{logger:i.logger,clientName:"LexRuntimeServiceClient",commandName:"PostContentCommand",inputFilterSensitiveLog:G.filterSensitiveLog,outputFilterSensitiveLog:$.filterSensitiveLog})},t.prototype.serialize=function(n,i){return function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n,i,s,r,l,u;return(0,a.Jh)(this,function(m){switch(m.label){case 0:if(n=(0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)((0,a.pi)({"content-type":"application/octet-stream","x-amz-content-sha256":"UNSIGNED-PAYLOAD"},R(e.sessionAttributes)&&{"x-amz-lex-session-attributes":Buffer.from(h.QT.fromObject(e.sessionAttributes)).toString("base64")}),R(e.requestAttributes)&&{"x-amz-lex-request-attributes":Buffer.from(h.QT.fromObject(e.requestAttributes)).toString("base64")}),R(e.contentType)&&{"content-type":e.contentType}),R(e.accept)&&{accept:e.accept}),R(e.activeContexts)&&{"x-amz-lex-active-contexts":Buffer.from(h.QT.fromObject(e.activeContexts)).toString("base64")}),i="/bot/{botName}/alias/{botAlias}/user/{userId}/content",void 0===e.botName)throw new Error("No value provided for input HTTP label: botName.");if((s=e.botName).length<=0)throw new Error("Empty value provided for input HTTP label: botName.");if(i=i.replace("{botName}",(0,h.jc)(s)),void 0===e.botAlias)throw new Error("No value provided for input HTTP label: botAlias.");if((s=e.botAlias).length<=0)throw new Error("Empty value provided for input HTTP label: botAlias.");if(i=i.replace("{botAlias}",(0,h.jc)(s)),void 0===e.userId)throw new Error("No value provided for input HTTP label: userId.");if((s=e.userId).length<=0)throw new Error("Empty value provided for input HTTP label: userId.");return i=i.replace("{userId}",(0,h.jc)(s)),void 0!==e.inputStream&&(r=e.inputStream),[4,t.endpoint()];case 1:return l=m.sent(),[2,new ge.aW({protocol:void 0===(u=l.protocol)?"https":u,hostname:l.hostname,port:l.port,method:"POST",headers:n,path:i,body:r})]}})})}(n,i)},t.prototype.deserialize=function(n,i){return function(e,t){return(0,a.mG)(void 0,void 0,void 0,function(){var n;return(0,a.Jh)(this,function(s){return 200!==e.statusCode&&e.statusCode>=300?[2,en(e,t)]:(n={$metadata:f(e),activeContexts:void 0,alternativeIntents:void 0,audioStream:void 0,botVersion:void 0,contentType:void 0,dialogState:void 0,inputTranscript:void 0,intentName:void 0,message:void 0,messageFormat:void 0,nluIntentConfidence:void 0,sentimentResponse:void 0,sessionAttributes:void 0,sessionId:void 0,slotToElicit:void 0,slots:void 0},void 0!==e.headers["content-type"]&&(n.contentType=e.headers["content-type"]),void 0!==e.headers["x-amz-lex-intent-name"]&&(n.intentName=e.headers["x-amz-lex-intent-name"]),void 0!==e.headers["x-amz-lex-nlu-intent-confidence"]&&(n.nluIntentConfidence=new h.QT(Buffer.from(e.headers["x-amz-lex-nlu-intent-confidence"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-alternative-intents"]&&(n.alternativeIntents=new h.QT(Buffer.from(e.headers["x-amz-lex-alternative-intents"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-slots"]&&(n.slots=new h.QT(Buffer.from(e.headers["x-amz-lex-slots"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-session-attributes"]&&(n.sessionAttributes=new h.QT(Buffer.from(e.headers["x-amz-lex-session-attributes"],"base64").toString("ascii"))),void 0!==e.headers["x-amz-lex-sentiment"]&&(n.sentimentResponse=e.headers["x-amz-lex-sentiment"]),void 0!==e.headers["x-amz-lex-message"]&&(n.message=e.headers["x-amz-lex-message"]),void 0!==e.headers["x-amz-lex-message-format"]&&(n.messageFormat=e.headers["x-amz-lex-message-format"]),void 0!==e.headers["x-amz-lex-dialog-state"]&&(n.dialogState=e.headers["x-amz-lex-dialog-state"]),void 0!==e.headers["x-amz-lex-slot-to-elicit"]&&(n.slotToElicit=e.headers["x-amz-lex-slot-to-elicit"]),void 0!==e.headers["x-amz-lex-input-transcript"]&&(n.inputTranscript=e.headers["x-amz-lex-input-transcript"]),void 0!==e.headers["x-amz-lex-bot-version"]&&(n.botVersion=e.headers["x-amz-lex-bot-version"]),void 0!==e.headers["x-amz-lex-session-id"]&&(n.sessionId=e.headers["x-amz-lex-session-id"]),void 0!==e.headers["x-amz-lex-active-contexts"]&&(n.activeContexts=new h.QT(Buffer.from(e.headers["x-amz-lex-active-contexts"],"base64").toString("ascii"))),n.audioStream=e.body,[2,Promise.resolve(n)])})})}(n,i)},t}(h.mY),Rn=g(5778),zn=g(5159),Pn=function(e){if(e instanceof Blob||e instanceof ReadableStream)return new Response(e).arrayBuffer().then(function(t){return new Uint8Array(t)});throw new Error("Readable is not supported.")},Fn=(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var r in s)s.hasOwnProperty(r)&&(i[r]=s[r])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),W=function(){return(W=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},ne=new O.k("AWSLexProvider"),Mn=function(e){function t(n){void 0===n&&(n={});var i=e.call(this,n)||this;return i._botsCompleteCallback={},i}return Fn(t,e),t.prototype.getProviderName=function(){return"AWSLexProvider"},t.prototype.reportBotStatus=function(n,i){var s=this;ne.debug("postContent state",n.dialogState),("ReadyForFulfillment"===n.dialogState||"Fulfilled"===n.dialogState)&&("function"==typeof this._botsCompleteCallback[i]&&setTimeout(function(){return s._botsCompleteCallback[i](null,{slots:n.slots})},0),this._config&&"function"==typeof this._config[i].onComplete&&setTimeout(function(){return s._config[i].onComplete(null,{slots:n.slots})},0)),"Failed"===n.dialogState&&("function"==typeof this._botsCompleteCallback[i]&&setTimeout(function(){return s._botsCompleteCallback[i]("Bot conversation failed")},0),this._config&&"function"==typeof this._config[i].onComplete&&setTimeout(function(){return s._config[i].onComplete("Bot conversation failed")},0))},t.prototype.sendMessage=function(n,i){return function(e,t,n,i){return new(n||(n=Promise))(function(r,l){function d(c){try{o(i.next(c))}catch(m){l(m)}}function u(c){try{o(i.throw(c))}catch(m){l(m)}}function o(c){c.done?r(c.value):function(r){return r instanceof n?r:new n(function(l){l(r)})}(c.value).then(d,u)}o((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var s,r,l,u,o,m,d,b,S;return function(e,t){var i,s,r,l,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function d(o){return function(c){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(r=2&o[0]?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,s=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!(r=(r=n.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){n=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){n.label=o[1];break}if(6===o[0]&&n.label<r[1]){n.label=r[1],r=o;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(o);break}r[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(c){o=[6,c],s=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}(this,function(v){switch(v.label){case 0:return this._config[n]?[4,Rn.cN.get()]:[2,Promise.reject("Bot "+n+" does not exist")];case 1:if(!(s=v.sent()))return[2,Promise.reject("No credentials")];if(this.lexRuntimeServiceClient=new We({region:this._config[n].region,credentials:s,customUserAgent:(0,zn.Zm)()}),"string"!=typeof i)return[3,6];r={botAlias:this._config[n].alias,botName:n,inputText:i,userId:s.identityId},ne.debug("postText to lex",i),v.label=2;case 2:return v.trys.push([2,4,,5]),l=new Ln(r),[4,this.lexRuntimeServiceClient.send(l)];case 3:return d=v.sent(),this.reportBotStatus(d,n),[2,d];case 4:return u=v.sent(),[2,Promise.reject(u)];case 5:return[3,11];case 6:o=i.content,r="voice"===i.options.messageType?{botAlias:this._config[n].alias,botName:n,contentType:"audio/x-l16; sample-rate=16000",inputStream:o,userId:s.identityId,accept:"audio/mpeg"}:{botAlias:this._config[n].alias,botName:n,contentType:"text/plain; charset=utf-8",inputStream:o,userId:s.identityId,accept:"audio/mpeg"},ne.debug("postContent to lex",i),v.label=7;case 7:return v.trys.push([7,10,,11]),m=new Nn(r),[4,this.lexRuntimeServiceClient.send(m)];case 8:return d=v.sent(),[4,Pn(d.audioStream)];case 9:return b=v.sent(),this.reportBotStatus(d,n),[2,W(W({},d),{audioStream:b})];case 10:return S=v.sent(),[2,Promise.reject(S)];case 11:return[2]}})})},t.prototype.onComplete=function(n,i){if(!this._config[n])throw new ErrorEvent("Bot "+n+" does not exist");this._botsCompleteCallback[n]=i},t}(Ie),X=function(){return(X=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},Se=new O.k("Interactions"),z=new(function(){function e(t){this._options=t,Se.debug("Interactions Options",this._options),this._pluggables={}}return e.prototype.getModuleName=function(){return"Interactions"},e.prototype.configure=function(t){var n=this,i=t?t.Interactions||t:{};Se.debug("configure Interactions",{opt:i}),this._options=X(X({bots:{}},i),i.Interactions);var s=this._options.aws_bots_config,r=this._options.bots;return!Object.keys(r).length&&s&&Array.isArray(s)&&s.forEach(function(l){n._options.bots[l.name]=l}),!this._pluggables.AWSLexProvider&&r&&Object.keys(r).map(function(l){return r[l]}).find(function(l){return!l.providerName||"AWSLexProvider"===l.providerName})&&(this._pluggables.AWSLexProvider=new Mn),Object.keys(this._pluggables).map(function(l){n._pluggables[l].configure(n._options.bots)}),this._options},e.prototype.addPluggable=function(t){if(t&&"Interactions"===t.getCategory()){if(this._pluggables[t.getProviderName()])throw new Error("Bot "+t.getProviderName()+" already plugged");return t.configure(this._options.bots),void(this._pluggables[t.getProviderName()]=t)}},e.prototype.send=function(t,n){return function(e,t,n,i){return new(n||(n=Promise))(function(r,l){function d(c){try{o(i.next(c))}catch(m){l(m)}}function u(c){try{o(i.throw(c))}catch(m){l(m)}}function o(c){c.done?r(c.value):function(r){return r instanceof n?r:new n(function(l){l(r)})}(c.value).then(d,u)}o((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function(){var i;return function(e,t){var i,s,r,l,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:d(0),throw:d(1),return:d(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function d(o){return function(c){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(r=2&o[0]?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,s=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!(r=(r=n.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){n=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){n.label=o[1];break}if(6===o[0]&&n.label<r[1]){n.label=r[1],r=o;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(o);break}r[2]&&n.ops.pop(),n.trys.pop();continue}o=t.call(e,n)}catch(c){o=[6,c],s=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}(this,function(s){switch(s.label){case 0:if(!this._options.bots||!this._options.bots[t])throw new Error("Bot "+t+" does not exist");if(!this._pluggables[i=this._options.bots[t].providerName||"AWSLexProvider"])throw new Error("Bot "+i+" does not have valid pluggin did you try addPluggable first?");return[4,this._pluggables[i].sendMessage(t,n)];case 1:return[2,s.sent()]}})})},e.prototype.onComplete=function(t,n){if(!this._options.bots||!this._options.bots[t])throw new Error("Bot "+t+" does not exist");var i=this._options.bots[t].providerName||"AWSLexProvider";if(!this._pluggables[i])throw new Error("Bot "+i+" does not have valid pluggin did you try addPluggable first?");this._pluggables[i].onComplete(t,n)},e}())(null);Ae.dQ.register(z);const Z=(e,t,n)=>{for(let i=0;i<n.length;i++)e.setUint8(t+i,n.charCodeAt(i))},Qn=(e,t,n,i)=>{const l=((e,t)=>{const n=2*e.length,s=8+n,l=new ArrayBuffer(36+s),d=new DataView(l);return Z(d,0,"RIFF"),d.setUint32(4,24+s,!0),Z(d,8,"WAVE"),Z(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,1,!0),d.setUint16(22,1,!0),d.setUint32(24,t,!0),d.setUint32(28,2*t,!0),d.setUint16(32,2,!0),d.setUint16(34,16,!0),Z(d,36,"data"),d.setUint32(40,n,!0),((e,t,n)=>{let i=44;for(let s=0;s<n.length;s++,i+=2){const r=Math.max(-1,Math.min(1,n[s]));e.setInt16(i,r<0?32768*r:32767*r,!0)}})(d,0,e),d})(((e,t,n)=>{if(n===t)return e;const i=t/n,s=Math.round(e.length/i),r=new Float32Array(s);let l=0,d=0;for(;l<r.length;){const u=Math.round((l+1)*i);let o=0,c=0;for(let m=d;m<u&&m<e.length;m++)o+=e[m],c++;r[l]=o/c,l++,d=u}return r})(((e,t)=>{const n=new Float32Array(t);let i=0;for(let s=0;s<e.length;s++)n.set(e[s],i),i+=e[s].length;return n})(e,t),n,i),i);return new Blob([l],{type:"application/octet-stream"})},we=new O.k("AudioRecorder");class Yn{constructor(t){this.streamBuffer=[],this.streamBufferLength=0,this.recording=!1,this.options=t}init(){var t=this;return(0,L.Z)(function*(){if(!(0,re.lC)().isBrowser)return t.audioSupported=!1,Promise.reject("Audio is not supported");window.AudioContext=window.AudioContext||window.webkitAudioContext,t.audioContext=new AudioContext,yield navigator.mediaDevices.getUserMedia({audio:!0}).then(n=>{t.audioSupported=!0,t.setupAudioNodes(n)}).catch(()=>(t.audioSupported=!1,Promise.reject("Audio is not supported")))})()}setupAudioNodes(t){var n=this;return(0,L.Z)(function*(){try{yield n.audioContext.resume()}catch(l){we.error(l)}const i=n.audioContext.createMediaStreamSource(t),s=n.audioContext.createScriptProcessor(4096,1,1);s.onaudioprocess=l=>{if(!n.recording)return;const d=l.inputBuffer.getChannelData(0);n.streamBuffer.push(new Float32Array(d)),n.streamBufferLength+=d.length,n.analyse()};const r=n.audioContext.createAnalyser();r.minDecibels=-90,r.maxDecibels=-10,r.smoothingTimeConstant=.85,i.connect(r),r.connect(s),s.connect(i.context.destination),n.analyserNode=r})()}startRecording(t,n){var i=this;return(0,L.Z)(function*(){if(i.recording||!i.audioSupported)return;i.onSilence=t||function(){},i.visualizer=n||function(){};const s=i.audioContext;try{yield s.resume()}catch(r){we.error(r)}i.start=Date.now(),i.recording=!0})()}stopRecording(){!this.audioSupported||(this.recording=!1)}clear(){this.stopRecording(),this.streamBufferLength=0,this.streamBuffer=[]}play(t){if(!t||!this.audioSupported)return;const n=new Blob([t]);return new Promise((i,s)=>{const r=new FileReader;r.onload=()=>{this.playbackSource&&this.playbackSource.disconnect(),this.playbackSource=this.audioContext.createBufferSource(),this.audioContext.decodeAudioData(r.result,u=>{this.playbackSource.buffer=u,this.playbackSource.connect(this.audioContext.destination),this.playbackSource.onended=()=>i(),this.playbackSource.start(0)},u=>s(u))},r.onerror=()=>s(),r.readAsArrayBuffer(n)})}stop(){this.playbackSource&&this.playbackSource.stop()}analyse(){if(!this.audioSupported)return;const t=this.analyserNode;t.fftSize=2048;const n=t.fftSize,i=new Uint8Array(n),s=this.options.amplitude,r=this.options.time;t.getByteTimeDomainData(i),this.visualizer(i,n);for(let u=0;u<n;u++){const o=i[u]/128-1;(o>s||o<-1*s)&&(this.start=Date.now())}Date.now()-this.start>r&&this.onSilence()}exportWAV(t=16e3){var n=this;return(0,L.Z)(function*(){if(!n.audioSupported)return;const s=Qn(n.streamBuffer,n.streamBufferLength,n.audioContext.sampleRate,t);return n.clear(),s})()}}var x=(()=>(function(e){e[e.Initial=0]="Initial",e[e.Listening=1]="Listening",e[e.SendingText=2]="SendingText",e[e.SendingVoice=3]="SendingVoice",e[e.Error=4]="Error"}(x||(x={})),x))(),E=(()=>(function(e){e.Bot="bot",e.User="user"}(E||(E={})),E))(),T=(()=>(function(e){e[e.Recoverable=0]="Recoverable",e[e.Unrecoverable=1]="Unrecoverable"}(T||(T={})),T))();const Ee=class{constructor(e){(0,_.r)(this,e),this.clearOnComplete=!1,this.conversationModeOn=!1,this.botTitle=P.T.CHATBOT_TITLE,this.voiceEnabled=!1,this.textEnabled=!0,this.silenceTime=1500,this.silenceThreshold=.2,this.messages=[],this.text="",this.chatState=x.Initial,this.messageJSX=t=>{const n=t.map(i=>(0,_.h)("div",{class:`bubble ${i.from}`},i.content));if(this.chatState===x.SendingText||this.chatState===x.SendingVoice){const i=this.chatState===x.SendingText?E.Bot:E.User;n.push((0,_.h)("div",{class:`bubble ${i}`},(0,_.h)("div",{class:`dot-flashing ${i}`},(0,_.h)("span",{class:"dot left"}),(0,_.h)("span",{class:"dot middle"}),(0,_.h)("span",{class:"dot right"}))))}return n},this.chatCompleted=(0,_.c)(this,"chatCompleted",7)}submitHandler(e){this.sendTextMessage()}componentWillLoad(){if(!z||"function"!=typeof z.onComplete)throw new Error(Te.c);this.validateProps()}componentDidRender(){const e=this.element.shadowRoot.querySelector(".body");e.scrollTop=e.scrollHeight}validateProps(){if(!this.voiceEnabled&&!this.textEnabled)return void this.setError(P.T.CHAT_DISABLED_ERROR,T.Unrecoverable);if(!this.botName)return void this.setError(P.T.NO_BOT_NAME_ERROR,T.Unrecoverable);this.welcomeMessage&&this.appendToChat(this.welcomeMessage,E.Bot),this.voiceEnabled&&(this.audioRecorder=new Yn({time:this.silenceTime,amplitude:this.silenceThreshold}),this.audioRecorder.init().catch(t=>{this.setError(t,T.Recoverable)}));const e=(t,n)=>{this.chatCompleted.emit({data:n,err:t}),this.clearOnComplete?this.reset():this.chatState=x.Initial};try{z.onComplete(this.botName,e)}catch(t){this.setError(t,T.Unrecoverable)}}handleSubmit(e){e.preventDefault(),this.sendTextMessage()}handleMicButton(){this.chatState===x.Initial&&(this.audioRecorder.stop(),this.chatState=x.Listening,this.audioRecorder.startRecording(()=>this.handleSilence(),(e,t)=>this.visualizer(e,t)))}handleSilence(){this.chatState=x.SendingVoice,this.audioRecorder.stopRecording(),this.audioRecorder.exportWAV().then(e=>{this.sendVoiceMessage(e)})}handleTextChange(e){this.text=e.target.value}handleCancelButton(){this.audioRecorder.clear(),this.chatState=x.Initial}handleToastClose(e){this.error=void 0,e===T.Recoverable&&(this.chatState=x.Initial)}visualizer(e,t){((e,t,n)=>{if(!n)return;if(!(0,re.lC)().isBrowser)throw new Error("Visualization is not supported on non-browsers.");const{width:i,height:s}=n.getBoundingClientRect();n.width=i,n.height=s;const r=n.getContext("2d");r.fillStyle="white",r.clearRect(0,0,i,s),requestAnimationFrame(()=>{r.fillRect(0,0,i,s),r.lineWidth=1;const d=getComputedStyle(document.documentElement).getPropertyValue("--amplify-primary-color");r.strokeStyle=d&&""!==d?d:"#ff9900",r.beginPath();const u=1*i/t;let o=0;for(let c=0;c<t||c%3==0;c++){const b=e[c]/128*s/2;0===c?r.moveTo(o,b):r.lineTo(o,b),o+=u}r.lineTo(n.width,n.height/2),r.stroke()})})(e,t,this.element.shadowRoot.querySelector("canvas"))}sendTextMessage(){var e=this;return(0,L.Z)(function*(){if(0===e.text.length||e.chatState!==x.Initial)return;const t=e.text;let n;e.text="",e.appendToChat(t,E.User),e.chatState=x.SendingText;try{n=yield z.send(e.botName,t)}catch(i){return void e.setError(i,T.Recoverable)}n.message&&e.appendToChat(n.message,E.Bot),e.chatState=x.Initial})()}sendVoiceMessage(e){var t=this;return(0,L.Z)(function*(){const n={content:e,options:{messageType:"voice"}};let i;try{i=yield z.send(t.botName,n)}catch(r){return void t.setError(r,T.Recoverable)}t.chatState=x.Initial;const s=i.dialogState;i.inputTranscript&&t.appendToChat(i.inputTranscript,E.User),t.appendToChat(i.message,E.Bot),yield t.audioRecorder.play(i.audioStream).then(()=>{t.conversationModeOn&&"Fulfilled"!==s&&"Failed"!==s&&t.chatState===x.Initial&&t.handleMicButton()}).catch(r=>t.setError(r,T.Recoverable))})()}appendToChat(e,t){this.messages=[...this.messages,{content:e,from:t}]}setError(e,t){const n="string"==typeof e?e:e.message;this.chatState=x.Error,this.error={message:n,errorType:t}}reset(){this.chatState=x.Initial,this.text="",this.error=void 0,this.messages=[],this.welcomeMessage&&this.appendToChat(this.welcomeMessage,E.Bot),this.audioRecorder&&this.audioRecorder.clear()}listeningFooterJSX(){return[(0,_.h)("canvas",{height:"50"}),(0,_.h)("amplify-button",{"data-test":"chatbot-cancel-button",handleButtonClick:()=>this.handleCancelButton(),class:"icon-button",variant:"icon",icon:"ban"})]}footerJSX(){return this.chatState===x.Listening?this.listeningFooterJSX():[(0,_.h)("amplify-input",{placeholder:Q.o.get(this.textEnabled?P.T.TEXT_INPUT_PLACEHOLDER:P.T.VOICE_INPUT_PLACEHOLDER),description:"text",handleInputChange:s=>this.handleTextChange(s),value:this.text,disabled:this.chatState===x.Error||!this.textEnabled}),this.voiceEnabled&&(0,_.h)("amplify-button",{"data-test":"chatbot-mic-button",handleButtonClick:()=>this.handleMicButton(),class:"icon-button",variant:"icon",icon:"microphone",disabled:this.chatState===x.Error||this.chatState!==x.Initial}),this.textEnabled&&(0,_.h)("amplify-button",{"data-test":"chatbot-send-button",class:"icon-button",variant:"icon",icon:"send",handleButtonClick:()=>this.sendTextMessage(),disabled:this.chatState===x.Error||this.chatState!==x.Initial})]}errorToast(){if(!this.error)return;const{message:e,errorType:t}=this.error;return(0,_.h)("amplify-toast",{message:Q.o.get(e),handleClose:()=>this.handleToastClose(t)})}render(){return(0,_.h)(_.H,null,(0,_.h)("div",{class:"amplify-chatbot"},(0,_.h)("slot",{name:"header"},(0,_.h)("div",{class:"header","data-test":"chatbot-header"},Q.o.get(this.botTitle))),(0,_.h)("div",{class:"body","data-test":"chatbot-body"},this.messageJSX(this.messages)),(0,_.h)("form",{onSubmit:e=>this.handleSubmit(e)},(0,_.h)("div",{class:"footer","data-test":"chatbot-footer"},this.footerJSX())),this.errorToast()))}get element(){return(0,_.g)(this)}};Ee.style=".bot .dot{background-color:var(--bot-dot-color)}.user .dot{background-color:var(--user-dot-color)}.dot-flashing{width:2.625rem}.dot-flashing .dot{display:inline-block;width:0.625rem;height:0.625rem;border-radius:10rem;opacity:0.65}.dot-flashing .left{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:0s;animation-delay:0s}.dot-flashing .middle{margin-left:0.375rem;margin-right:0.375rem;-webkit-animation:dot-flashing 1s infinite linear alternate;animation:dot-flashing 1s infinite linear alternate;-webkit-animation-delay:0.5s;animation-delay:0.5s}.dot-flashing .right{-webkit-animation:dot-flashing 1s infinite alternate;animation:dot-flashing 1s infinite alternate;-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}@keyframes dot-flashing{0%{opacity:0.65}50%,100%{opacity:0.1}}:host{--width:28.75rem;--height:37.5rem;--header-color:var(--amplify-secondary-color);--header-size:var(--amplify-text-lg);--bot-background-color:rgb(230, 230, 230);--bot-text-color:black;--bot-dot-color:var(--bot-text-color);--user-background-color:var(--amplify-blue);--user-text-color:var(--amplify-white);--user-dot-color:var(--user-text-color)}.amplify-chatbot{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;background-color:var(--background-color);border-radius:0.375rem;-webkit-box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);box-shadow:0.0625rem 0rem 0.25rem 0 rgba(0, 0, 0, 0.15);-webkit-box-sizing:border-box;box-sizing:border-box;font-family:var(--amplify-font-family);margin-bottom:1rem;width:100%;height:var(--height);max-width:var(--width)}@media (min-width: 672px){.amplify-chatbot{width:var(--width)}}.header{padding:1.25rem 0.375rem 1.25rem 0.375rem;color:var(--header-color);font-size:var(--header-size);font-weight:bold;text-align:center;word-wrap:break-word}.body{border-top:0.0625rem solid rgba(0, 0, 0, 0.05);padding:1.5rem 1rem 0 1rem;display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;-ms-flex-direction:column;flex-direction:column;overflow:auto}.bubble{max-width:100%;padding:0.8em 1.4em;text-align:left;word-wrap:break-word;margin-bottom:0.625rem}.bot{margin-right:auto;background-color:var(--bot-background-color);color:var(--bot-text-color);border-radius:1.5rem 1.5rem 1.5rem 0}.user{margin-left:auto;background-color:var(--user-background-color);color:var(--user-text-color);border-radius:1.5rem 1.5rem 0 1.5rem}.footer{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;border-top:0.062rem solid rgba(0, 0, 0, 0.05);padding-right:0.625rem;min-height:3.125rem}.footer amplify-input{--border:none;--margin:0;-ms-flex-positive:1;flex-grow:1}canvas{margin-left:0.625rem;margin-right:0.625rem;-ms-flex-positive:1;flex-grow:1;height:3.125rem}.icon-button{--icon-height:1.25rem;--icon-fill:var(--amplify-primary-color);--padding:0.625rem;--width:auto}"}}]);